# -*- coding: utf-8 -*-
"""Fashion Visual Director Chatbot.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1ORqiR0q3IYV0xcpkRVuqZhVHLI8hfjox
"""

# visual_director_app.py
!pip install openai streamlit

import os
from datetime import datetime

import streamlit as st

# â”€â”€ OpenAI SDK v1 ë°©ì‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
try:
    from openai import OpenAI
except ImportError:
    st.error("openai íŒ¨í‚¤ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. í„°ë¯¸ë„ì—ì„œ `pip install openai streamlit` í›„ ë‹¤ì‹œ ì‹¤í–‰í•˜ì„¸ìš”.")
    st.stop()

st.set_page_config(page_title="Fashion Visual Director Bot", layout="wide", page_icon="ğŸ¬")

# ì‚¬ì´ë“œë°”: API Key & ì„¤ì •
with st.sidebar:
    st.title("âš™ï¸ ì„¤ì •")
    OPENAI_API_KEY = st.text_input("OpenAI API Key", type="password", value=os.getenv("OPENAI_API_KEY", ""))
    model = st.selectbox("ëª¨ë¸", ["gpt-4o-mini", "gpt-4o", "gpt-4.1-mini"])
    temperature = st.slider("Temperature", 0.0, 1.0, 0.6, 0.05)
    max_tokens = st.slider("Max tokens", 256, 4096, 1200, 64)
    st.caption("â€» KeyëŠ” ë©”ëª¨ë¦¬ì—ë§Œ ë³´ê´€ë©ë‹ˆë‹¤.")

st.title("ğŸ¬ íŒ¨ì…˜ ë¹„ì£¼ì–¼ ë””ë ‰í„° ì±—ë´‡")

# ì…ë ¥ í¼
col1, col2 = st.columns(2)
with col1:
    project_name = st.text_input("í”„ë¡œì íŠ¸/ì»¬ë ‰ì…˜ ì´ë¦„", "Autumn Fragment")
    format_choice = st.selectbox("í¬ë§·", ["í™”ë³´ (Editorial)", "ëŸ°ì›¨ì´ (Runway)", "ì˜¨ë¼ì¸ ë£©ë¶ (Lookbook)"])
    target = st.text_input("íƒ€ê¹ƒ (ì˜ˆ: 20-30ëŒ€, K-fashion lovers ë“±)", "20-30ëŒ€, ë¬´ë“œ ì¤‘ì‹¬ íŠ¸ë Œë“œ ì†Œë¹„ì")
with col2:
    keywords = st.text_input("í‚¤ì›Œë“œ/í…Œë§ˆ (ì‰¼í‘œë¡œ êµ¬ë¶„)", "deconstructivism, muted pastels")
    budget_note = st.text_input("ì˜ˆì‚°/ì œì•½(ì„ íƒ)", "Low budget - student project")
user_prompt = st.text_area("ë””í…Œì¼ ìš”ì²­", "ì›ë‹¨ì˜ ì§ˆê°ê³¼ ë””í…Œì¼ì´ ê°•ì¡°ë˜ëŠ” ìŠ¤íŠœë””ì˜¤ í™”ë³´. ìì—°ê´‘ ëŠë‚Œ")

# ì—­í•  í”„ë¡¬í”„íŠ¸
system_prompt = """
ë„ˆëŠ” 'íŒ¨ì…˜ ë¹„ì£¼ì–¼ ë””ë ‰í„°'ì•¼.
ì‚¬ìš©ìê°€ ì¤€ ì •ë³´(í”„ë¡œì íŠ¸ëª…, í¬ë§·, íƒ€ê¹ƒ, í‚¤ì›Œë“œ, ì˜ˆì‚°ì œì•½, ë””í…Œì¼)ë¥¼ ì½ê³  ë‹¤ìŒ í•­ëª©ì„ ì¶œë ¥í•´:
1) í•µì‹¬ ì½˜ì…‰íŠ¸(í•œ ë¬¸ì¥)
2) ë¹„ì£¼ì–¼ ë””ë ‰ì…˜: ì¡°ëª…/ì´¬ì˜ìŠ¤íƒ€ì¼/êµ¬ì„±/ëª¨ë¸ìŠ¤íƒ€ì¼/ì†Œí’ˆ(ê° í•­ëª© 2-4ê°€ì§€)
3) ì»¬ëŸ¬ íŒ”ë ˆíŠ¸: 3~5ê°œì˜ HEX ì½”ë“œ ë° ê°„ë‹¨í•œ ì„¤ëª…
4) í…ìŠ¤ì²˜/ì†Œì¬ ì¶”ì²œ(3ê°œ)
5) ìƒ·ë¦¬ìŠ¤íŠ¸(3ì»·) - ê° ì»·ì˜ êµ¬ì„±ê³¼ ëª©ì 
6) ì˜ˆì‚°/ì‹œê°„ ì œì•½ ìˆì„ ë•Œì˜ í˜„ì‹¤ì ì¸ ë³€í˜• íŒ (ê° 1-2ê°œ)
ì¶œë ¥ì€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±í•˜ê³ , ì‹¤ë¬´ì—ì„œ ë°”ë¡œ ì°¸ê³ í•  ìˆ˜ ìˆê²Œ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´.
""".strip()

# ë©”ì‹œì§€ êµ¬ì„± í•¨ìˆ˜
def build_messages():
    user_content = f"""
[í”„ë¡œì íŠ¸ëª…] {project_name}
[í¬ë§·] {format_choice}
[íƒ€ê¹ƒ] {target}
[í‚¤ì›Œë“œ/í…Œë§ˆ] {keywords}
[ì˜ˆì‚°/ì œì•½] {budget_note}
[ë””í…Œì¼ ìš”ì²­] {user_prompt}
""".strip()
    return [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_content},
    ]

# ì‹¤í–‰ ë²„íŠ¼
if st.button("âœ¨ ì œì•ˆ ìƒì„±"):
    if not OPENAI_API_KEY:
        st.error("OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì‚¬ì´ë“œë°”).")
        st.stop()

    try:
        client = OpenAI(api_key=OPENAI_API_KEY)
        resp = client.chat.completions.create(
            model=model,
            messages=build_messages(),
            temperature=temperature,
            max_tokens=max_tokens,
        )
        text = resp.choices[0].message.content.strip()
        st.markdown("### ê²°ê³¼")
        st.markdown(text)

        # ì„ íƒ: ê°„ë‹¨ ì €ì¥
        with st.expander("ë¡œê·¸ ì €ì¥í•˜ê¸°"):
            if st.checkbox("í˜„ì¬ ê²°ê³¼ë¥¼ íŒŒì¼ë¡œ ì €ì¥"):
                ts = datetime.now().strftime("%Y%m%d_%H%M%S")
                fname = f"{project_name}_{ts}.md"
                with open(fname, "w", encoding="utf-8") as f:
                    f.write(text)
                st.success(f"ì €ì¥ë¨: {fname}")

    except Exception as e:
        st.error(f"API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜: {e}")